From c68bcb66e0bbbeaa98c649c2986f4521186630d0 Mon Sep 17 00:00:00 2001
Message-Id: <c68bcb66e0bbbeaa98c649c2986f4521186630d0.1615225947.git.marksvc@gmail.com>
From: MarkS <marksvc@gmail.com>
Date: Mon, 8 Mar 2021 11:51:16 -0600
Subject: [PATCH 1/3] Add additional option debugging when lauching FLEx

Change-Id: I86d6dc12fe609ecd92cf583f8acec1ac021ff796
---
 Lib/linux/run-app    | 14 ++++++++------
 Lib/linux/setup-user | 12 ++++++++++++
 2 files changed, 20 insertions(+), 6 deletions(-)

diff --git a/Lib/linux/run-app b/Lib/linux/run-app
index 969d1262..c739ccb1 100755
--- a/fw/Lib/linux/run-app
+++ b/fw/Lib/linux/run-app
@@ -9,6 +9,11 @@ share=$prefix/share/fieldworks
 sharedWsRoot=/var/lib/fieldworks
 sharedWs=$sharedWsRoot/SIL/WritingSystemStore
 
+# Usage: debug "foo baz" "bar"
+debug() {
+  [[ -z ${FW_DEBUG} ]] || printf "$(date +'%F %T') run-app[$$]: " "$@"
+}
+
 # Test for write permissions in global writing system store.
 # If things are not set right, tell the user about it, erring on the side of
 # giving them more information than less, to help them solve it.
@@ -84,9 +89,6 @@ cd "$lib"; RUNMODE="INSTALLED" . environ; cd $OLDPWD
 #fi
 
 cd "$share" # Temporary
-echo DEBUG before running mono, env, pwd, FW_MONO_OPTS, and args are
-env
-pwd
-echo DEBUG FW_MONO_OPTS: ${FW_MONO_OPTS}
-echo DEBUG args: "$@"
-exec mono ${FW_MONO_OPTS} --debug "$lib"/"$@"
+command="mono ${FW_MONO_OPTS} --debug ""$lib"/"$@"
+debug "Executing ${command} from dir $(pwd) in the following environment:\n$(env)"
+exec ${command}
diff --git a/Lib/linux/setup-user b/Lib/linux/setup-user
index 50212308..ad067cd7 100755
--- a/fw/Lib/linux/setup-user
+++ b/fw/Lib/linux/setup-user
@@ -19,8 +19,19 @@ FW_SHARE=$prefix/share/fieldworks
 WRITEKEY="${FW_LIB}/WriteKey.exe"
 READKEY="${FW_LIB}/ReadKey.exe"
 
+# Usage: Debug "foo baz" "bar"
+Debug()
+{
+	[[ -z ${FW_DEBUG} ]] || printf "$(date +'%F %T') setup-user[$$]: " "$@"
+}
+
+Debug "XDG_DATA_HOME is ${XDG_DATA_HOME}"
+Debug "XDG_CONFIG_HOME is ${XDG_CONFIG_HOME}"
+Debug "prefix is ${prefix}"
+
 WriteKey()
 {
+	Debug "Writing" "$@"
 	mono "${WRITEKEY}" "$@"
 }
 
@@ -78,6 +89,7 @@ CopyRegistryKey()
 
 	# Are there FW 9 registry settings?
 	if ReadKey LM "Software/SIL/FieldWorks/9" "ProjectsDir" 2>/dev/null; then
+		Debug "There are already FW 9 registry settings."
 		# All done!
 		:
 	else
-- 
2.25.1

